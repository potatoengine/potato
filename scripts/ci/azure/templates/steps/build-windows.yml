parameters:
  build_shared: Shared
  configuration: RelWithDebInfo

steps:
- script: |
    echo on
    setlocal enableextensions enabledelayedexpansion

    set ROOT=%BUILD_SOURCESDIRECTORY%
    set CONFIG=${{parameters.configuration}}
    if ${{parameters.build_shared}} EQU Share (set SHARED=ON) else (set SHARED=OFF)
    set build_dir=build/%CONFIG%-${{parameters.build_shared}}

    mkdir "${build_dir}"
    cd "${build_dir}"

    rem configure
    cmake -A x64 -DSDL2_PATH:PATH="%ROOT%/deps/SDL2-2.0.9" -DBUILD_SHARED_LIBS=%SHARED% -DASSIMP_ROOT_DIR:PATH="%ROOT%/deps/assimp-4.1.0" "%ROOT%"

    rem build
    cmake --build . --config %CONFIG% --parallel

    rem run tests
    ctest -R grimm -C %CONFIG% --verbose
  displayName: Build (${{parameters.configuration}} ${{parameters.build_shared}})
