parameters:
  build_shared: Shared
  configuration: RelWithDebInfo

steps:
- bash: |
    set -xe

    build_config='${{parameters.configuration}}'
    build_shared=$([ '{{parameters.build_shared}}' == 'Shared' ] && echo 'ON' || echo 'OFF')
    build_dir="${build_config}-${{parameters.build_shared}}"

    mkdir -p "${build_dir}"
    cd "${build_dir}"

    # configure
    cmake -A x64 -DSDL2_PATH:PATH="${BUILD_SOURCESDIRECTORY}/deps/SDL2-2.0.9" -DBUILD_SHARED_LIBS=${build_shared} -DASSIMP_ROOT_DIR:PATH="${BUILD_SOURCESDIRECTORY}/deps/assimp-4.1.0" "${BUILD_SOURCESDIRECTORY}"

    # build
    cmake --build . --config "${build_config}" --parallel

    # run tests
    ctest -R grimm -C "${build_config}" --verbose
  displayName: Build (${{parameters.configuration}} ${{parameters.build_shared}})
