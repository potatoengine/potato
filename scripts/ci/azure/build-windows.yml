parameters:
  build_shared: false

steps:
- bash: |
    set -xe
    curl -o SDL2-devel-2.0.9-VC.zip -L https://www.libsdl.org/release/SDL2-devel-2.0.9-VC.zip
    unzip SDL2-devel-2.0.9-VC.zip -d "${BUILD_SOURCESDIRECTORY}/deps"
    curl -o assimp-4.1.0.zip -L https://grimmdeps.blob.core.windows.net/deps/assimp-4.1.0.zip
    unzip assimp-4.1.0.zip -d "${BUILD_SOURCESDIRECTORY}/deps"
  displayName: Installing Dependencies
- script: |
    "C:\Program Files (x86)\Microsoft Visual Studio\Installer\vswhere.exe" -requires Microsoft.VisualStudio.Component.VC.Tools.x86.x64
    cmake --version
  displayName: Build Information
- bash: |
    set -xe
    build_dir='RelWithDebInfo-Shared'
    build_shared=$([ '{{parameters.build_shared}}' == 'true' ] && echo 'ON' || echo 'OFF')
    mkdir -p "${build_dir}"
    cd "${build_dir}"
    cmake -A x64 -DSDL2_PATH:PATH="${BUILD_SOURCESDIRECTORY}/deps/SDL2-2.0.9" -DBUILD_SHARED_LIBS=${build_shared} -DASSIMP_ROOT_DIR:PATH="${BUILD_SOURCESDIRECTORY}/deps/assimp-4.1.0" "${BUILD_SOURCESDIRECTORY}"
    cmake --build . --config RelWithDebInfo --parallel
    ctest -R grimm -C RelWithDebInfo --verbose
  displayName: Build (RelWithDebInfo Shared)
- bash: |
    set -xe
    build_dir='Debug-Static'
    build_shared=$([ '{{parameters.build_shared}}' == 'true' ] && echo 'ON' || echo 'OFF')
    mkdir -p "${build_dir}"
    cd "${build_dir}"
    cmake -A x64 -DSDL2_PATH:PATH="${BUILD_SOURCESDIRECTORY}/deps/SDL2-2.0.9" -DBUILD_SHARED_LIBS=${build_shared} -DASSIMP_ROOT_DIR:PATH="${BUILD_SOURCESDIRECTORY}/deps/assimp-4.1.0" "${BUILD_SOURCESDIRECTORY}"
    cmake --build . --config Debug --parallel
    ctest -R grimm -C Debug --verbose
  displayName: Build (Debug Static)
